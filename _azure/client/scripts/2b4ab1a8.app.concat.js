"use strict";angular.module("n4j",["n4j.common","n4j.pages","n4j.templates"]),angular.module("n4j").config(["$locationProvider","$urlRouterProvider",function($locationProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!0)}]).run(["$rootScope","$state","$stateParams",function($rootScope,$state,$stateParams){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams}]),angular.module("n4j.templates",[]),angular.module("n4j.common",["n4j.common.utils","n4j.common.directives","n4j.common.services"]),angular.module("n4j.common.utils",[]),angular.module("n4j.common.directives",[]),angular.module("n4j.common.services",[]),angular.module("n4j.common.directives").directive("particles",["_","$window","requestAnimFrame","Particle","particleUtils",function(_,$window,requestAnimFrame,Particle,particleUtils){var clearCanvas=function(ctx){ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.restore()},addParticles=function(ctx,radius,count){for(var particles=[],canvas=ctx.canvas,W=canvas.width,H=canvas.height,i=0;count>i;i++)particles.push(new Particle(ctx,radius,W,H));var animloop=function(){particleUtils.draw(ctx,particles,W,H),requestAnimFrame(animloop)};animloop()},link=function(scope,el,attrs){var width=parseFloat(attrs.canvasWidth)/100,height=parseFloat(attrs.canvasHeight)/100,canvas=el[0],particleCount=attrs.particles,radius=4,ctx=canvas.getContext("2d"),setDimen=function(){ctx.canvas.width=el.parent()[0].clientWidth*(width||1),ctx.canvas.height=el.parent()[0].clientHeight*(height||1)},resizeHandler=function(){setDimen(ctx),clearCanvas(ctx),addParticles(ctx,radius,particleCount)};angular.element($window).bind("resize",_.debounce(resizeHandler,100)),setTimeout(function(){setDimen(ctx),clearCanvas(ctx),addParticles(ctx,radius,particleCount)},300)};return{restrict:"AE",link:link}}]),angular.module("n4j.common.services").service("superfastBlur",function(){var mul_table=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shg_table=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18];return this.boxBlurImage=function(imageID,canvasID,radius,blurAlphaChannel,iterations){var img=document.getElementById(imageID),w=img.naturalWidth,h=img.naturalHeight,canvas=document.getElementById(canvasID);canvas.style.width=w+"px",canvas.style.height=h+"px",canvas.width=w,canvas.height=h;var context=canvas.getContext("2d");context.clearRect(0,0,w,h),context.drawImage(img,0,0),isNaN(radius)||1>radius||(blurAlphaChannel?this.boxBlurCanvasRGBA(canvasID,0,0,w,h,radius,iterations):this.boxBlurCanvasRGB(canvasID,0,0,w,h,radius,iterations))},this.boxBlurCanvasRGBA=function(id,top_x,top_y,width,height,radius,iterations){if(!(isNaN(radius)||1>radius)){radius|=0,isNaN(iterations)&&(iterations=1),iterations|=0,iterations>3&&(iterations=3),1>iterations&&(iterations=1);var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw console.log("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw console.log("Cannot access image"),new Error("unable to access image data: "+e)}for(var rsum,gsum,bsum,asum,x,y,i,p,p1,p2,yp,yi,yw,pa,pixels=imageData.data,wm=width-1,hm=height-1,rad1=radius+1,mul_sum=mul_table[radius],shg_sum=shg_table[radius],r=[],g=[],b=[],a=[],vmin=[],vmax=[];iterations-->0;){for(yw=yi=0,y=0;height>y;y++){for(rsum=pixels[yw]*rad1,gsum=pixels[yw+1]*rad1,bsum=pixels[yw+2]*rad1,asum=pixels[yw+3]*rad1,i=1;radius>=i;i++)p=yw+((i>wm?wm:i)<<2),rsum+=pixels[p++],gsum+=pixels[p++],bsum+=pixels[p++],asum+=pixels[p];for(x=0;width>x;x++)r[yi]=rsum,g[yi]=gsum,b[yi]=bsum,a[yi]=asum,0===y&&(vmin[x]=((p=x+rad1)<wm?p:wm)<<2,vmax[x]=(p=x-radius)>0?p<<2:0),p1=yw+vmin[x],p2=yw+vmax[x],rsum+=pixels[p1++]-pixels[p2++],gsum+=pixels[p1++]-pixels[p2++],bsum+=pixels[p1++]-pixels[p2++],asum+=pixels[p1]-pixels[p2],yi++;yw+=width<<2}for(x=0;width>x;x++){for(yp=x,rsum=r[yp]*rad1,gsum=g[yp]*rad1,bsum=b[yp]*rad1,asum=a[yp]*rad1,i=1;radius>=i;i++)yp+=i>hm?0:width,rsum+=r[yp],gsum+=g[yp],bsum+=b[yp],asum+=a[yp];for(yi=x<<2,y=0;height>y;y++)pixels[yi+3]=pa=asum*mul_sum>>>shg_sum,pa>0?(pa=255/pa,pixels[yi]=(rsum*mul_sum>>>shg_sum)*pa,pixels[yi+1]=(gsum*mul_sum>>>shg_sum)*pa,pixels[yi+2]=(bsum*mul_sum>>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,0===x&&(vmin[y]=((p=y+rad1)<hm?p:hm)*width,vmax[y]=(p=y-radius)>0?p*width:0),p1=x+vmin[y],p2=x+vmax[y],rsum+=r[p1]-r[p2],gsum+=g[p1]-g[p2],bsum+=b[p1]-b[p2],asum+=a[p1]-a[p2],yi+=width<<2}}context.putImageData(imageData,top_x,top_y)}},this.boxBlurCanvasRGB=function(id,top_x,top_y,width,height,radius,iterations){if(!(isNaN(radius)||1>radius)){radius|=0,isNaN(iterations)&&(iterations=1),iterations|=0,iterations>3&&(iterations=3),1>iterations&&(iterations=1);var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw console.log("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw console.log("Cannot access image"),new Error("unable to access image data: "+e)}for(var rsum,gsum,bsum,x,y,i,p,p1,p2,yp,yi,yw,pixels=imageData.data,wm=width-1,hm=height-1,rad1=radius+1,r=[],g=[],b=[],mul_sum=mul_table[radius],shg_sum=shg_table[radius],vmin=[],vmax=[];iterations-->0;){for(yw=yi=0,y=0;height>y;y++){for(rsum=pixels[yw]*rad1,gsum=pixels[yw+1]*rad1,bsum=pixels[yw+2]*rad1,i=1;radius>=i;i++)p=yw+((i>wm?wm:i)<<2),rsum+=pixels[p++],gsum+=pixels[p++],bsum+=pixels[p++];for(x=0;width>x;x++)r[yi]=rsum,g[yi]=gsum,b[yi]=bsum,0===y&&(vmin[x]=((p=x+rad1)<wm?p:wm)<<2,vmax[x]=(p=x-radius)>0?p<<2:0),p1=yw+vmin[x],p2=yw+vmax[x],rsum+=pixels[p1++]-pixels[p2++],gsum+=pixels[p1++]-pixels[p2++],bsum+=pixels[p1++]-pixels[p2++],yi++;yw+=width<<2}for(x=0;width>x;x++){for(yp=x,rsum=r[yp]*rad1,gsum=g[yp]*rad1,bsum=b[yp]*rad1,i=1;radius>=i;i++)yp+=i>hm?0:width,rsum+=r[yp],gsum+=g[yp],bsum+=b[yp];for(yi=x<<2,y=0;height>y;y++)pixels[yi]=rsum*mul_sum>>>shg_sum,pixels[yi+1]=gsum*mul_sum>>>shg_sum,pixels[yi+2]=bsum*mul_sum>>>shg_sum,0===x&&(vmin[y]=((p=y+rad1)<hm?p:hm)*width,vmax[y]=(p=y-radius)>0?p*width:0),p1=x+vmin[y],p2=x+vmax[y],rsum+=r[p1]-r[p2],gsum+=g[p1]-g[p2],bsum+=b[p1]-b[p2],yi+=width<<2}}context.putImageData(imageData,top_x,top_y)}},this}),angular.module("n4j.common.services").factory("requestAnimFrame",function(){return function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)}}()}).factory("Particle",function(){var Particle=function(ctx,radius,width,height){this.ctx=ctx,this.radius=radius,this.x=Math.random()*width,this.y=Math.random()*height,this.vx=-1+2*Math.random(),this.vy=-1+2*Math.random(),this.draw=function(){this.ctx.fillStyle="rgba(200,200,200,0.8)",this.ctx.beginPath(),this.ctx.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.ctx.fill()}};return Particle}).service("particleUtils",["utils",function(utils){var distance=function(ctx,count,p1,p2){var dist,minDist=70,dx=p1.x-p2.x,dy=p1.y-p2.y;if(dist=Math.sqrt(dx*dx+dy*dy),minDist>=dist){var fill="rgba(255,255,255,"+(1.2-dist/minDist)+")";ctx.beginPath(),ctx.strokeStyle=fill,ctx.moveTo(p1.x,p1.y),ctx.lineTo(p2.x,p2.y),ctx.stroke(),ctx.closePath();var ax=dx/(utils.getRandomInt(50,150)*count),ay=dy/(utils.getRandomInt(50,150)*count);p1.vx-=ax,p1.vy-=ay,p2.vx+=ax,p2.vy+=ay}},update=function(ctx,particles,width,height){for(var i=0;i<particles.length;i++){var p=particles[i];p.x+=p.vx,p.y+=p.vy,p.x+p.radius>width?p.x=p.radius:p.x-p.radius<0&&(p.x=width-p.radius),p.y+p.radius>height?p.y=p.radius:p.y-p.radius<0&&(p.y=height-p.radius);for(var j=i+1;j<particles.length;j++){var p2=particles[j];distance(ctx,particles.length,p,p2)}}},paintCanvas=function(ctx,width,height){ctx.clearRect(0,0,width,height)};return this.draw=function(ctx,particles,width,height){paintCanvas(ctx,width,height);for(var i=0;i<particles.length;i++){var p=particles[i];p.draw()}update(ctx,particles,width,height)},this}]),angular.module("n4j.common.utils").factory("_",function(){return window._}).factory("utils",function(){return this.getRandomInt=function(min,max){return~~(Math.random()*(max-min+1))+min},this}),angular.module("n4j.pages",["angular-growl","fx.animations","highcharts-ng","ngAnimate","ngResource","ngCookies","restangular","ui.bootstrap","ui.router.compat","n4j.pages.controllers","n4j.pages.directives","n4j.pages.services"]),angular.module("n4j.pages").config(["$stateProvider","RestangularProvider","$httpProvider","growlProvider",function($stateProvider,RestangularProvider,$httpProvider,growlProvider){$stateProvider.state("public",{"abstract":!0,url:"/",templateUrl:"pages/templates/public.tpl.html"}).state("public.home",{url:"",templateUrl:"pages/templates/home.tpl.html",controller:"HomeCtrl",data:{bodyId:"home"}}).state("public.login",{url:"login",templateUrl:"pages/templates/login.tpl.html",controller:"AuthCtrl",data:{bodyId:"auth"},resolve:{auth:function($q,$window,$n4Auth){var deferred=$q.defer();return $n4Auth.isLoggedIn()?$window.location.href="/profile":deferred.resolve(),deferred.promise}}}).state("public.about",{url:"about",templateUrl:"pages/templates/about.tpl.html",data:{bodyId:"about"}}).state("app",{"abstract":!0,url:"/app",templateUrl:"pages/templates/protected.tpl.html",resolve:{auth:function($q,$window,$n4Auth){var deferred=$q.defer();return $n4Auth.isLoggedIn()?deferred.resolve():$window.location.href="/login",deferred.promise},user:function($n4User){return $n4User.get()}}}).state("app.browse",{"abstract":!0,url:"^/browse",templateUrl:"pages/templates/browse.tpl.html",controller:"BrowseCtrl",resolve:{jobs:function($n4Jobs){return $n4Jobs.list()}}}).state("app.browse.list",{url:"",templateUrl:"pages/templates/browse.list.tpl.html"}).state("app.browse.detail",{url:"/:id",views:{detail:{controller:"BrowseDetailCtrl",templateUrl:"pages/templates/browse.detail.tpl.html"}}}).state("app.profile",{url:"^/profile",templateUrl:"pages/templates/profile.tpl.html",controller:"ProfileCtrl",data:{bodyId:"profile"}}).state("app.setup",{"abstract":!0,url:"^/profile/setup",template:"<div ui-view></div>"}).state("app.setup.locations",{url:"/locations",templateUrl:"pages/templates/setup.locations.tpl.html",controller:"SetupCtrl",data:{bodyId:"profile"}}).state("app.setup.skills",{url:"/skills",templateUrl:"pages/templates/setup.skills.tpl.html",controller:"SetupCtrl",data:{bodyId:"profile"}}),RestangularProvider.setBaseUrl("/api/v0"),RestangularProvider.setDefaultHeaders({api_key:"special-key"}),RestangularProvider.addResponseInterceptor(function(data,operation){var extracted=null;return"getList"===operation?extracted=data.list:"get"===operation?(extracted=data.node.data,extracted.nodeId=data.node.nodeId):extracted=data,extracted}),$httpProvider.defaults.transformRequest.unshift(function(data){var key,result=[];for(key in data)data.hasOwnProperty(key)&&result.push(encodeURIComponent(key)+"="+encodeURIComponent(data[key]));return result.join("&")}),growlProvider.globalTimeToLive(3e3)}]),angular.module("n4j.pages.controllers",[]),angular.module("n4j.pages.directives",[]),angular.module("n4j.pages.services",[]),angular.module("n4j.pages.controllers").controller("BaseCtrl",["$rootScope","$scope","$state","$stateParams","_",function($rootScope,$scope,$state,$stateParams,_){var getBodyId,getBodyClasses;getBodyId=function(){return $state.current.data&&$state.current.data.bodyId?$state.current.data.bodyId:void 0},getBodyClasses=function(){var classes,merged;return classes=[],$state.current.data&&$state.current.data.bodyClasses&&(classes=classes.concat($state.current.data.bodyClasses.split(" "))),classes.push($stateParams.page?"page-"+$state.$current.parent.name.replace(/\./,"-"):"page-"+$state.current.name.replace(/\./g,"-")),merged="page",_.forEach($stateParams,function(val,key){"page"!==key&&(merged+="-"+val,classes.push(merged))}),classes.join(" ")},$rootScope.$on("$stateChangeSuccess",function(){$scope.bodyId=getBodyId(),$scope.bodyClasses=getBodyClasses()})}]),angular.module("n4j.pages.controllers").controller("AuthCtrl",function(){}),angular.module("n4j.pages").controller("BrowseCtrl",["_","$rootScope","$scope","$state","$stateParams","$resource","jobs","$n4User","$n4Jobs","growl",function(_,$rootScope,$scope,$state,$stateParams,$resource,jobs,$n4User,$n4Jobs,growl){$scope.jobs=jobs,$scope.currentJob=null,$scope.listType="Recommended";var loadMore=function(){var type="",listType=$scope.listType;"Likes"===listType&&(type="likes"),"Latest"===listType&&(type="latest"),$n4Jobs.list(type).then(function(jobs){var ids=_.map(jobs,function(job){return job.id});jobs=_.filter(jobs,function(job){return!_.contains(ids,job.id)}),$scope.jobs=$scope.jobs.concat(jobs)})};$scope.goTo=function(job){$scope.currentJob=job,$state.go("app.browse.detail",{id:job.id})},$scope.rate=function(job,rating){var jobId=job.id,msg="",index=_.findIndex(jobs,function(job){return job.id===jobId});msg="like"===rating?"Successfully liked "+job.title:"Successfully disliked "+job.title,$n4User.rateJob(jobId,rating).then(function(){growl.addSuccessMessage(msg),$scope.currentJob.id===jobId&&$scope.goTo($scope.jobs[index+1]),$scope.jobs.splice(index,1),$scope.jobs.length<=10&&loadMore()})},$scope.archive=function(job){console.log("@TODO Archive",job)},$scope.show=function(listType){var type="";"Likes"===listType&&(type="likes"),"Latest"===listType&&(type="latest"),$scope.listType=listType,$n4Jobs.list(type).then(function(jobs){$scope.jobs=jobs})},$stateParams.id||$scope.goTo(jobs[0])}]),angular.module("n4j.pages").controller("BrowseDetailCtrl",["_","$rootScope","$scope","$stateParams","$n4Jobs","jobs","user","$timeout",function(_,$rootScope,$scope,$stateParams,$n4Jobs,jobs,user){var userSkills=_.map(user.skills,function(skill){return skill.data.normalized}),colors=["#F25A29","#AD62CE","#30B6AF","#FCC940","#FF6C7C","#4356C0","#DFE1E3"];_.each($scope.currentJob,function(val,key){$scope[key]=val}),$scope.jobTitle=$scope.title,$scope.hasSkill=function(skill){return _.contains(userSkills,skill.normalized)},$scope.isOldJob=function(date){var today=new Date;return date=Date.parse(date),today-date>15552e6},$scope.chartDateRange="day",$scope.chartConfig={options:{colors:colors,legend:{align:"center",floating:!1,itemStyle:{fontSize:"10px"},symbolHeight:12,symbolWidth:12,verticalAlign:"top"},plotOptions:{series:{lineWidth:2},area:{fillOpacity:.2,dashStyle:"ShortDot"}},chart:{type:"area"}},series:[{name:"Applicants",yAxis:0,pointInterval:864e5,pointStart:Date.UTC(2014,5,28),data:[5,10,15,12,8,7,18],style:{color:colors[0]}},{name:"Angel List Score",yAxis:1,pointInterval:864e5,pointStart:Date.UTC(2014,5,28),data:[36,51,47,67,72,80,74],style:{color:colors[1]}}],size:{height:300,width:300},title:{style:{display:"none"}},xAxis:[{dateTimeLabelFormats:{month:"%b %y",year:"%y",day:"%d"},type:"datetime",showFirstLabel:!1,showLastLabel:!1,startOnTick:!1}],yAxis:[{title:{text:"Applicants",style:{display:"none",color:colors[0]}},labels:{style:{"font-size":"10px","font-weight":"bold",color:colors[0]}}},{gridLineWidth:0,title:{text:"Angel List Score",style:{display:"none",color:colors[1]}},labels:{style:{"font-size":"10px","font-weight":"bold",color:colors[1]}},opposite:!0}],loading:!1}}]),angular.module("n4j.pages.controllers").controller("HomeCtrl",["$scope",function($scope){console.log($scope)}]),angular.module("n4j.pages.controllers").controller("ProfileCtrl",["_","$state","$scope","$n4User","growl",function(_,$state,$scope,$n4User,growl){var _user=null;$scope.skills={},$n4User.get().then(function(user){_user=_.pick(user,["firstname","lastname","email"]),$scope.user=_.clone(_user)}),$n4User.getSkills().then(function(skills){$scope.skills=skills}),$n4User.getLocations().then(function(locations){$scope.locations=locations}),$scope.save=function(){_.isEqual(_user,$scope.user)?growl.addInfoMessage("Nothing Changed"):$n4User.save($scope.user).then(function(){growl.addSuccessMessage("Profile Successfully Updated")})},$scope.deleteAccount=function(){$n4User.del().then(function(){growl.addSuccessMessage("Sorry to see you go."),setTimeout(function(){$state.go("home")},1500)})}}]),angular.module("n4j.pages.controllers").controller("SetupCtrl",["_","$q","$scope","$state","$n4Auth","$n4Skills","$n4User","growl",function(_,$q,$scope,$state,$n4Auth,$n4Skills,$n4User,growl){var list=null,_original=null,_deletedItems=[],state=$state.is("app.setup.skills")&&"skills"||$state.is("app.setup.locations")&&"locations",extractStringsToCompare=function(arr){return _.map(arr,function(item){return"skills"===state?item.name:"locations"===state?item.city:void 0})};"skills"===state&&(list=$n4Skills.list()),$scope.itemToAdd="","skills"===state?$n4User.getSkills().then(function(skills){_original=_.clone(skills),$scope.selectedItems=skills}):"locations"===state&&$n4User.getLocations().then(function(locations){_original=_.clone(locations),$scope.selectedItems=locations}),$scope.getSuggestion=function(str){return list.then(function(items){var _tmp=extractStringsToCompare($scope.selectedItems),results=_.filter(items,function(item){return"locations"===state?!0:"skills"===state?!_.contains(_tmp,item.name)&&-1!==item.name.toLowerCase().indexOf(str):void 0});return results})},$scope.select=function(item){$scope.selectedItems.push(item),$scope.itemToAdd=""},$scope.onEnter=function(e){13===e.keyCode&&$scope.itemToAdd&&($scope.selectedItems.push({name:$scope.itemToAdd}),$scope.itemToAdd="")},$scope.remove=function(index){_deletedItems.push($scope.selectedItems.splice(index,1)[0])},$scope.save=function(){var promises=[];if(_.isEqual(_original,$scope.selectedItems))growl.addInfoMessage("Nothing Changed");else{var _tmp=null;_tmp=extractStringsToCompare(_original);var _newItems=_.filter($scope.selectedItems,function(item){var strToCompare="skills"===state&&item.name||"locations"===state&&item.city;return!_.contains(_tmp,strToCompare)});if(_newItems.length){var toCreate={};toCreate[state]=_newItems,promises.push($n4User.save(toCreate))}var toDelete={};_tmp=extractStringsToCompare($scope.selectedItems),_deletedItems=_.filter(_deletedItems,function(item){var strToCompare="skills"===state&&item.name||"locations"===state&&item.city;return!_.contains(_tmp,strToCompare)}),toDelete[state]=_deletedItems,_deletedItems.length&&promises.push($n4User.removeRelationships(toDelete)),$q.all(promises).then(function(){growl.addSuccessMessage("Profile Successfully Updated"),setTimeout(function(){$state.go("app.profile")},500)})}}}]),angular.module("n4j.pages.directives").directive("home",function(){var def={};return def={priority:10,link:function(){}}}),angular.module("n4j.pages.directives").directive("setChartSize",["_","$window",function(_,$window){var ctrl=function($scope){this.resizeHandler=function(el){$scope.chartConfig.size.width=el[0].clientWidth,$scope.$apply()}},link=function(scope,el,attrs,ctrl){setTimeout(function(){ctrl.resizeHandler(el)},100),angular.element($window).bind("resize",_.debounce(function(){ctrl.resizeHandler(el)},100))};return{controller:ctrl,link:link}}]),angular.module("n4j.pages.services").service("$n4Auth",["$cookies",function($cookies){var user=$cookies.user;if(user){var matches=user.match(/({.+})+/gi);user=angular.fromJson(matches[0])}return this.isLoggedIn=function(){return!!user},this.getUser=function(){return user},this}]),angular.module("n4j.pages.services").service("$n4Jobs",["_","Restangular","$n4Auth",function(_,Restangular,$n4Auth){var user=$n4Auth.getUser(),_extractJobs=function(jobs){var res=_.map(jobs,function(job){var data=job.data;return data});return res};return this.list=function(type){var params={type:type||""};return Restangular.one("users",user.id).getList("jobs",params).then(function(jobs){return _extractJobs(jobs)})},this}]),angular.module("n4j.pages.services").service("$n4Skills",["_","Restangular",function(_,Restangular){return this.list=function(){return Restangular.all("skills").getList().then(function(nodes){return nodes=_.map(nodes,function(node){var data=node.data;return data})})},this.get=function(id){return Restangular.one("skills",id).get()},this}]),angular.module("n4j.pages.services").service("$n4User",["_","$http","$n4Auth","Restangular",function(_,$http,$n4Auth,Restangular){var baseUrl="/api/v0/users/",config={headers:{api_key:"special-key","Content-Type":"application/x-www-form-urlencoded"}},restAuth=Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/auth")}),user=$n4Auth.getUser();return this.save=function(data){var url=baseUrl+user.id;return _.each(data,function(value,key,collection){"object"==typeof value&&(collection[key]=JSON.stringify(value))}),$http.put(url,data,config)},this.get=function(){return restAuth.one("currentUser").get().then(function(user){return user})},this.getSkills=function(){return restAuth.one("currentUser").get().then(function(user){var skills=_.map(user.skills,function(node){return node.data});return skills})},this.getLocations=function(){return restAuth.one("currentUser").get().then(function(user){var locations=_.map(user.locations,function(node){return node.data});return locations=locations.length>0&&locations||[{city:"San Francisco"}]})},this.rateJob=function(jobId,rating){var like="like"===rating&&!0||!1,url=baseUrl+user.id+"/jobs/"+jobId,data={like:like};return $http.post(url,data,config)},this.removeRelationships=function(data){var url=baseUrl+user.id+"/relationships";return _.each(data,function(value,key,collection){"object"==typeof value&&(collection[key]=JSON.stringify(value))}),$http.put(url,data,config)},this.del=function(){var url=baseUrl+user.id;return $http.delete(url,config)},this}]);